(
    features: (bits: 0x0000_0000_0000_0008), // PIPELINE_STATISTICS_QUERY
    expectations: [
        (
            name: "Queried number of compute invocations is correct",
            buffer: (index: 0, epoch: 1),
            offset: 0,
            data: U64([0x0, 0x2A]),
        ),
    ],
    actions: [
        CreatePipelineLayout(0x04, (
            label: Some("empty"),
            bind_group_layouts: [],
            push_constant_ranges: [],
        )),
        Assign(trace_id: 0x04, resource_id: 0x04),
        CreateShaderModule(
            id: 0x03,
            desc: (
                label: None,
                flags: (bits: 3),
            ),
            data: "empty.wgsl",
        ),
        Assign(trace_id: 0x03, resource_id: 0x03),
        CreateComputePipeline(
            id: 0x06,
            desc: (
                label: None,
                layout: Some(0x04),
                stage: (
                    module: 0x03,
                    entry_point: "main",
                ),
            ),
        ),
        Assign(trace_id: 0x06, resource_id: 0x06),
        CreateQuerySet(
            id: 0x02,
            desc: (
                label: Some("Compute Invocation QuerySet"),
                count: 2,
                ty: PipelineStatistics((bits: 0x18)), // FRAGMENT_SHADER_INVOCATIONS | COMPUTE_SHADER_INVOCATIONS
            ),
        ),
        Assign(trace_id: 0x02, resource_id: 0x02),
        CreateBuffer(
            Id(0, 1, Empty),
            (
                label: Some("Compute Invocation Result Buffer"),
                size: 16,
                usage: (
                    bits: 9, // COPY_DST | MAP_READ
                ),
                mapped_at_creation: false,
            ),
        ),
        Submit(1, [
            RunComputePass(
                base: (
                    commands: [
                        SetPipeline(0x06),
                        BeginPipelineStatisticsQuery(
                            query_set_id: 0x02,
                            query_index: 0,
                        ),
                        Dispatch((2, 3, 7,)),
                        EndPipelineStatisticsQuery,
                    ],
                    dynamic_offsets: [],
                    string_data: [],
                    push_constant_data: [],
                ),
            ),
            ResolveQuerySet(
                query_set_id: 0x02,
                start_query: 0,
                query_count: 1,
                destination: Id(0, 1, Empty),
                destination_offset: 0,
            )
        ]),
    ],
)
